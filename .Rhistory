ppdms01 <- read.and.remove.top.line("abcd_ppdms01")
read.and.remove.top.line <- function(filename){
file <- paste0("data/raw_data/",filename,".txt") # set the location of the file to read
dat <- read.delim(file) # read the file into R
dat <- dat[-1,] # remove the top row
dat # return the dataset
}
getwd()
setwd("~/OneDrive - University of Exeter/Dissertations/abcd_menstrual_traits/shared_2223_abcd")
ppdms01 <- read.and.remove.top.line("abcd_ppdms01") # parent-completed puberty questionnaire
View(ppdms01)
ypdms01 <- read.and.remove.top.line("abcd_ypdms01") # YP-completed puberty questionnaire
setwd("~/OneDrive - University of Exeter/Dissertations/abcd_menstrual_traits/Package_1204091")
ksad01 <- read.and.remove.top.line("abcd_ksad01")
getwd()
ksad01<-read.delim("abcd_ksad01.txt")
ksad01 <- ksad01[-1,]
View(ksad01)
table(ksad01$ksads_1_158_p)
rm(list=ls9)
rm(list=ls())
ppdms01 <- read.and.remove.top.line("abcd_ppdms01") # parent-completed puberty questionnaire
read.and.remove.top.line <- function(filename){
file <- paste0("data/raw_data/",filename,".txt") # set the location of the file to read
dat <- read.delim(file) # read the file into R
dat <- dat[-1,] # remove the top row
dat # return the dataset
}
## Then I can apply that function to any raw data file:
setwd("~/OneDrive - University of Exeter/Dissertations/abcd_menstrual_traits/shared_2223_abcd") # First I need to set the working directory (if you try to re-run this script, you will have to update this path to point it to the correct folder on your computer)
ppdms01 <- read.and.remove.top.line("abcd_ppdms01") # parent-completed puberty questionnaire
ypdms01 <- read.and.remove.top.line("abcd_ypdms01") # YP-completed puberty questionnaire
bpm01 <- read.and.remove.top.line("bpm01")
bpm01 <- read.and.remove.top.line("abcd_bpm01")
bpmt01 <- read.and.remove.top.line("abcd_bpmt01")
cbcl01 <- read.and.remove.top.line("abcd_cbcl01")
cbcls01 <- read.and.remove.top.line("abcd_cbcls01")
ksad01 <- read.and.remove.top.line("abcd_ksad01")
ksad501 <- read.and.remove.top.line("abcd_ksad501")
mhp02 <- read.and.remove.top.line("abcd_mhp02")
mhy02 <- read.and.remove.top.line("abcd_mhy02")
eating_disorders_p01 <- read.and.remove.top.line("eating_disorders_p01")
eating_disorders01 <- read.and.remove.top.line("eating_disorders01")
generaled_anx_disorder_p01 <- read.and.remove.top.line("generaled_anx_disorder_p01")
generaled_anx_disorder01 <- read.and.remove.top.line("generaled_anx_disorder01")
social_anxiety_disorder_p01 <- read.and.remove.top.line("social_anxiety_disorder_p01")
social_anxiety_disorder01 <- read.and.remove.top.line("social_anxiety_disorder01")
View(cbcl01)
table(cbcls01$cbcl_scr_dsm5_depress_t)
ls()
ppdms01 <- code.missing.values(ppdms01)
code.missing.values <- function(dat){
dat[dat==""] <- NA # change all ""s to NAs
dat # return the dataset
}
ppdms01 <- code.missing.values(ppdms01)
ypdms01 <- code.missing.values(ypdms01)
table(ppdms01$menstrualcycle4_p)
ypdms01 <- code.missing.values(ypdms01)
bpmt01 <- code.missing.values(bpmt01)
bpm01 <- code.missing.values(bpm01)
cbcl01 <- code.missing.values(cbcl01)
cbcls01 <- code.missing.values(cbcls01)
ksad01 <- code.missing.values(ksad01)
ksad501 <- code.missing.values(ksad501)
mhp02 <- code.missing.values(mhp02)
mhy02 <- code.missing.values(mhy02)
eating_disorders_p01 <- code.missing.values(eating_disorders_p01)
eating_disorders01 <- code.missing.values(eating_disorders01)
eating_disorders_p01 <- code.missing.values(eating_disorders_p01)
eating_disorders01 <- code.missing.values(eating_disorders01)
generaled_anx_disorder_p01 <- code.missing.values(generaled_anx_disorder_p01)
generaled_anx_disorder01 <- code.missing.values(generaled_anx_disorder01)
social_anxiety_disorder_p01 <- code.missing.values(social_anxiety_disorder_p01)
social_anxiety_disorder01 <- code.missing.values(social_anxiety_disorder01)
code.missing.values <- function(dat){
dat[dat==""|dat==777|dat==999] <- NA # change all ""s, 777s or 999s to NAs
dat # return the dataset
}
ppdms01 <- code.missing.values(ppdms01)
ypdms01 <- code.missing.values(ypdms01)
bpmt01 <- code.missing.values(bpmt01)
bpm01 <- code.missing.values(bpm01)
cbcl01 <- code.missing.values(cbcl01)
cbcls01 <- code.missing.values(cbcls01)
ksad01 <- code.missing.values(ksad01)
ksad501 <- code.missing.values(ksad501)
mhp02 <- code.missing.values(mhp02)
mhy02 <- code.missing.values(mhy02)
eating_disorders_p01 <- code.missing.values(eating_disorders_p01)
eating_disorders01 <- code.missing.values(eating_disorders01)
eating_disorders_p01 <- code.missing.values(eating_disorders_p01)
eating_disorders01 <- code.missing.values(eating_disorders01)
generaled_anx_disorder_p01 <- code.missing.values(generaled_anx_disorder_p01)
generaled_anx_disorder01 <- code.missing.values(generaled_anx_disorder01)
social_anxiety_disorder_p01 <- code.missing.values(social_anxiety_disorder_p01)
social_anxiety_disorder01 <- code.missing.values(social_anxiety_disorder01)
table(ppdms01$menstrualcycle1_p)
table(ppdms01$menstrualcycle5_p)
getwd()
write.csv(ppdms01,"data/raw_data/raw_data_after_prep/ppdms01.csv",row.names = F)
write.csv(ypdms01,"data/raw_data/raw_data_after_prep/ypdms01.csv",row.names = F)
write.csv(ppdms01,"data/raw_data/raw_data_after_prep/ppdms01.csv",row.names = F)
write.csv(ypdms01,"data/raw_data/raw_data_after_prep/ypdms01.csv",row.names = F)
write.csv(bpmt01,"data/raw_data/raw_data_after_prep/bpmt01.csv",row.names = F)
write.csv(bpm01,"data/raw_data/raw_data_after_prep/bpm01.csv",row.names = F)
write.csv(cbcl01,"data/raw_data/raw_data_after_prep/cbcl01.csv",row.names = F)
write.csv(cbcls01,"data/raw_data/raw_data_after_prep/cbcls01.csv",row.names = F)
write.csv(ksad01,"data/raw_data/raw_data_after_prep/ksad01.csv",row.names = F)
write.csv(ksad501,"data/raw_data/raw_data_after_prep/ksad501.csv",row.names = F)
write.csv(mhp02,"data/raw_data/raw_data_after_prep/mhp02.csv",row.names = F)
write.csv(mhy02,"data/raw_data/raw_data_after_prep/mhy02.csv",row.names = F)
write.csv(eating_disorders01,"data/raw_data/raw_data_after_prep/eating_disorders01.csv",row.names = F)
write.csv(eating_disorders_p01,"data/raw_data/raw_data_after_prep/eating_disorders_p01.csv",row.names = F)
write.csv(generaled_anx_disorder01,"data/raw_data/raw_data_after_prep/generaled_anx_disorder01.csv",row.names = F)
write.csv(generaled_anx_disorder_p01,"data/raw_data/raw_data_after_prep/generaled_anx_disorder_p01.csv",row.names = F)
write.csv(social_anxiety_disorder01,"data/raw_data/raw_data_after_prep/social_anxiety_disorder01.csv",row.names = F)
write.csv(social_anxiety_disorder_p01,"data/raw_data/raw_data_after_prep/social_anxiety_disorder_p01.csv",row.names = F)
names(ppdms01)
names(ypdms01)
View(ppdms01)
summary(ppdms01$src_subject_id %in% ypdms01$src_subject_id)
table(unique(ppdms$src_subject_id))
table(unique(ppdms01$src_subject_id))
table(duplicated(ppdms01$src_subject_id))
table(duplicated(ppdms01$src_subject_id),ppdms01$eventname)
table(duplicated(ypdms01$src_subject_id),ypdms01$eventname)
unique(ppdms01$eventname)
sort(unique(ppdms01$eventname))
ppdms01$eventname2 <- replace(x = ppdms01$eventname,
list= sort(unique(ppdms01$eventname)),
values = c(1,2,3,0)
)
ppdms01$eventname
sort(unique(ppdms01$eventname))
ppdms01$eventname2 <- replace(x = ppdms01$eventname,
list= c(sort(unique(ppdms01$eventname)),NA),
values = c(1,2,3,0,NA)
)
w <- factor(ppdms01$eventname, levels = sort(unique(ppdms01$eventname)), labels = c(1,2,3,0))
table(w)
table(ppdms01$eventname)
ppdms01$eventname <- as.character(factor(ppdms01$eventname, levels = sort(unique(ppdms01$eventname)), labels = c(1,2,3,0)))
table(ppdms01$eventname)
require(tidyr)
pivot_wider(ppdms01,id_cols = "src_subject_id",names_from = "eventname")->w
name(ppdms01)
names(ppdms01)
table(ppdms01$pubertal_sex_p)
table(ppdms01$pds_1_p)
ppdms01 <- ppdms01[,c("src_subject_id","eventname","
interview_age","sex",names(ppdms01)[grep(names(ppdms01),pattern="pds|menstrual")])]
ppdms01 <- ppdms01[,c("src_subject_id","eventname",
"interview_age","sex",names(ppdms01)[grep(names(ppdms01),pattern="pds|menstrual")])]
name(ppdms01)
names(ppdms01)
pivot_wider(ppdms01,id_cols = "src_subject_id",names_from = "eventname")->w
pivot_wider(ppdms01)->w
df_wide <- ppdms01 %>%
pivot_wider(names_from=c(eventname), values_from=srs_subject_id)
names(ppdms01)
df_wide <- ppdms01 %>%
pivot_wider(names_from=c(eventname), values_from=src_subject_id)
names(df_wide)
df_wide <- reshape(ppdms01,idvar = "src_subject_id",timevar = "eventname",direction = "wide")
head(df_wide)
table(ppdms01$sex.0)
table(df_wide$sex.0)
table(df_wide$sex.0,useNA = "always")
df_wide <- reshape(ppdms01,idvar = "src_subject_id",timevar = "eventname",direction = "wide",drop = c("sex"))
names(df_wide)
names(ypdms01)
ppdms01 <- read.and.remove.top.line("abcd_ppdms01") # parent-completed puberty questionnaire
ppdms01 <- code.missing.values(ppdms01)
menstrual_data <- merge(ppdms01,ypdms01,by=c("src_subject_id","eventname"),all=T)
names(menstrual_data)
summary(menstrual_data$interview_age.x==menstrual_data$interview_age.y)
summary(menstrual_data$sex.x==menstrual_data$sex.y)
menstrual_data <- menstrual_data[,c("src_subject_id","eventname",
"interview_age.x","sex.x",names(menstrual_data)[grep(names(menstrual_data),pattern="menstrual")])]
names(menstrual_data)
menstrual_data$eventname <- as.character(factor(menstrual_data$eventname, levels = sort(unique(menstrual_data$eventname)), labels = c(1,2,3,0)))
df_wide <- reshape(menstrual_data,idvar = "src_subject_id",timevar = "eventname",direction = "wide")
names(df_wide)
View(df_wide)
summary(menstrual_data$interview_age.x)
summary(as.numeric(menstrual_data$interview_age.x))
107/12
174/12
summary(as.numeric(df_wide$interview_age.x.0))
133/12
summary(as.numeric(df_wide$interview_age.x.3))
137/12
summary(is.na(as.numeric(df_wide$interview_age.x.3)))
summary(as.numeric(df_wide$interview_age.x.3)>161)
161/12
menstrual_data_wide <- reshape(menstrual_data,idvar = "src_subject_id",timevar = "eventname",direction = "wide")
menstrual_data_wide[,c("sex.x.1","sex.x.2","sex.x.3")] <- NULL
menstrual_data_wide[,c("sex.x.0")]<-"sex"
View(menstrual_data_wide
)
colnames(menstrual_data_wide$sex.x.0)-"sex"
colnames(menstrual_data_wide$sex.x.0)
menstrual_data_wide
colnames(menstrual_data_wide)
menstrual_data_wide$sex <- menstrual_data_wide$sex.x.0
menstrual_data_wide[,c("sex.x.0","sex.x.1","sex.x.2","sex.x.3")] <- NULL
names(menstrual_data_wide)
names(menstrual_data)
write.csv(menstrual_data,"data/raw_data/raw_data_after_prep/menstrual_data_long.csv",row.names = F)
menstrual_data_wide <- reshape(menstrual_data,idvar = "src_subject_id",timevar = "eventname",direction = "wide")
menstrual_data_wide$sex <- menstrual_data_wide$sex.x.0
menstrual_data_wide[,c("sex.x.0","sex.x.1","sex.x.2","sex.x.3")] <- NULL
write.csv(menstrual_data_wide,"data/raw_data/raw_data_after_prep/menstrual_data_wide.csv",row.names = F)
menstrual_data$sex <- menstrual_data_wide$sex.x
menstrual_data$interview_age <- menstrual_data_wide$interview_age.x
menstrual_data$sex.x <- NULL
menstrual_data$interview_age.x <-NULL
write.csv(menstrual_data,"data/raw_data/raw_data_after_prep/menstrual_data_long.csv",row.names = F)
menstrual_data_wide <- reshape(menstrual_data,idvar = "src_subject_id",timevar = "eventname",direction = "wide")
## remove duplicate sex columns
names(menstrual_data_wide)
names(menstrual_data)
menstrual_data <- merge(ppdms01,ypdms01,by=c("src_subject_id","eventname"),all=T)
## Then select only the columns we need:
menstrual_data <- menstrual_data[,c("src_subject_id","eventname",
"interview_age.x","sex.x",names(menstrual_data)[grep(names(menstrual_data),pattern="menstrual")])]
## rename sex.x and interview_age.x to sex and interview_age:
menstrual_data$sex <- menstrual_data_wide$sex.x
menstrual_data$interview_age <- menstrual_data_wide$interview_age.x
menstrual_data$sex.x <- NULL
menstrual_data$interview_age.x <-NULL
names(menstrual_data)
menstrual_data <- merge(ppdms01,ypdms01,by=c("src_subject_id","eventname"),all=T)
## Then select only the columns we need:
menstrual_data <- menstrual_data[,c("src_subject_id","eventname",
"interview_age.x","sex.x",names(menstrual_data)[grep(names(menstrual_data),pattern="menstrual")])]
## rename sex.x and interview_age.x to sex and interview_age:
menstrual_data$sex <- menstrual_data_wide$sex.x
menstrual_data$interview_age <- menstrual_data_wide$interview_age.x
names(menstrual_data)
menstrual_data$sex <- menstrual_data_wide$sex.x
names(menstrual_data)
View(menstrual_data)
menstrual_data <- merge(ppdms01,ypdms01,by=c("src_subject_id","eventname"),all=T)
## Then select only the columns we need:
menstrual_data <- menstrual_data[,c("src_subject_id","eventname",
"interview_age.x","sex.x",names(menstrual_data)[grep(names(menstrual_data),pattern="menstrual")])]
## rename sex.x and interview_age.x to sex and interview_age:
menstrual_data$sex <- menstrual_data$sex.x
menstrual_data$interview_age <- menstrual_data$interview_age.x
menstrual_data$sex.x <- NULL
menstrual_data$interview_age.x <-NULL
names(menstrual_data)
menstrual_data$eventname <- as.character(factor(menstrual_data$eventname, levels = sort(unique(menstrual_data$eventname)), labels = c(1,2,3,0)))
## We can save this now:
write.csv(menstrual_data,"data/raw_data/raw_data_after_prep/menstrual_data_long.csv",row.names = F)
## Now we can put the data into wide format
menstrual_data_wide <- reshape(menstrual_data,idvar = "src_subject_id",timevar = "eventname",direction = "wide")
names(menstrual_data_wide)
menstrual_data_wide$sex <- menstrual_data_wide$sex.0
menstrual_data_wide[,c("sex.0","sex.1","sex.2","sex.3")] <- NULL
write.csv(menstrual_data_wide,"data/raw_data/raw_data_after_prep/menstrual_data_wide.csv",row.names = F)
install.packages("embedr")
remotes::install_github("mccarthy-m-g/embedr")
remotes::install_github("mccarthy-m-g/embedr")
